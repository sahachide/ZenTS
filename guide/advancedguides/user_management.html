<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>User and Session Management | ZenTS - Node.js &amp; TypeScript MVC-Framework for building rich web applications</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" size="57x57" href="/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" size="60x60" href="/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" size="72x72" href="/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" size="76x76" href="/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" size="114x114" href="/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" size="120x120" href="/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" size="144x144" href="/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" size="152x152" href="/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" size="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" size="192x192" href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" size="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" size="96x96" href="/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" size="16x16" href="/favicon/favicon-16x16.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600;700;800&amp;family=Raleway:wght@400;500;600;700;800;900&amp;display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
    <script>                
        window.addEventListener('load', function () {
          var inputSelector = '.search-box > input';
          var $el = document.querySelector(inputSelector);

          if($el) {          
            $el.disabled = true;
            $el.placeholder = 'Loading...';
  
            var script = document.createElement("script");
            script.addEventListener("load", function() {
              docsearch({
                apiKey: '1c03de24a87faf1bfd8b7e760c63b3ab',
                indexName: 'zents',
                inputSelector: inputSelector,
              });
              $el.disabled = false;
              $el.placeholder = 'Search...';
            });
  
            script.src = "https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js";
  
            document.body.appendChild(script);            
          }
        });
      </script>
    <meta name="description" content="ZenTS is a Node.js & TypeScript MVC-Framework for building rich web applications, released as free and open-source software under the MIT License. It is designed for building web applications with modern tools and design patterns.">
    <meta name="keywords" content="ZenTS guide tutorial documentation user users sessions session framework mvc TypeScript">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#512DA8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.5f5f71b9.css" as="style"><link rel="preload" href="/assets/js/app.ff0d6eb6.js" as="script"><link rel="preload" href="/assets/js/2.1831a849.js" as="script"><link rel="preload" href="/assets/js/26.dcb85366.js" as="script"><link rel="preload" href="/assets/js/4.be0fa7c4.js" as="script"><link rel="prefetch" href="/assets/js/10.f60de0dc.js"><link rel="prefetch" href="/assets/js/11.f70646e3.js"><link rel="prefetch" href="/assets/js/12.7d400f46.js"><link rel="prefetch" href="/assets/js/13.75ca8dc6.js"><link rel="prefetch" href="/assets/js/14.53bbd6c1.js"><link rel="prefetch" href="/assets/js/15.485b7772.js"><link rel="prefetch" href="/assets/js/16.d701e551.js"><link rel="prefetch" href="/assets/js/17.e2a1a4bc.js"><link rel="prefetch" href="/assets/js/18.279c874a.js"><link rel="prefetch" href="/assets/js/19.bd5220e3.js"><link rel="prefetch" href="/assets/js/20.9bbbcf25.js"><link rel="prefetch" href="/assets/js/21.8bbbd12a.js"><link rel="prefetch" href="/assets/js/22.46e6349d.js"><link rel="prefetch" href="/assets/js/23.403bfdcc.js"><link rel="prefetch" href="/assets/js/24.1c0b9c00.js"><link rel="prefetch" href="/assets/js/25.1d5dbc6b.js"><link rel="prefetch" href="/assets/js/27.86601334.js"><link rel="prefetch" href="/assets/js/28.ac72a169.js"><link rel="prefetch" href="/assets/js/29.04ae9240.js"><link rel="prefetch" href="/assets/js/3.656260b0.js"><link rel="prefetch" href="/assets/js/30.24ce4d2b.js"><link rel="prefetch" href="/assets/js/5.61ba91d2.js"><link rel="prefetch" href="/assets/js/6.1b9fb03d.js"><link rel="prefetch" href="/assets/js/7.379d2cb5.js"><link rel="prefetch" href="/assets/js/8.630c86f7.js"><link rel="prefetch" href="/assets/js/9.3cbbae49.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5f5f71b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/zents_logo_icon.png" alt="ZenTS - Node.js &amp; TypeScript MVC-Framework for building rich web applications" class="logo"> <span class="site-name can-hide">ZenTS - Node.js &amp; TypeScript MVC-Framework for building rich web applications</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/configuration.html" class="nav-link">
  Configuration
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API Reference
</a></div><div class="nav-item"><a href="/cli.html" class="nav-link">
  CLI
</a></div><div class="nav-item"><a href="/roadmap.html" class="nav-link">
  Roadmap
</a></div> <a href="https://github.com/sahachide/ZenTS" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/configuration.html" class="nav-link">
  Configuration
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API Reference
</a></div><div class="nav-item"><a href="/cli.html" class="nav-link">
  CLI
</a></div><div class="nav-item"><a href="/roadmap.html" class="nav-link">
  Roadmap
</a></div> <a href="https://github.com/sahachide/ZenTS" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Getting started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/gettingstarted/installation.html" class="sidebar-link">Installation &amp; Setup</a></li><li><a href="/guide/gettingstarted/helloworld.html" class="sidebar-link">Hello World Example</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Advanced Guides</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/advancedguides/controllers.html" class="sidebar-link">Controllers</a></li><li><a href="/guide/advancedguides/request.html" class="sidebar-link">Request Context</a></li><li><a href="/guide/advancedguides/response.html" class="sidebar-link">Response Context</a></li><li><a href="/guide/advancedguides/routing.html" class="sidebar-link">Routing</a></li><li><a href="/guide/advancedguides/database.html" class="sidebar-link">Database / ORM</a></li><li><a href="/guide/advancedguides/redis.html" class="sidebar-link">Redis</a></li><li><a href="/guide/advancedguides/user_management.html" aria-current="page" class="active sidebar-link">User and Session Management</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#a-basic-example" class="sidebar-link">A basic example</a></li><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#choosing-the-right-auth-strategy" class="sidebar-link">Choosing the right auth strategy</a></li><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#accessing-a-user-session" class="sidebar-link">Accessing a user session</a></li><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#managing-session-related-data" class="sidebar-link">Managing session related data</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#enable-redis-session-store" class="sidebar-link">Enable redis session store</a></li><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#enable-database-session-store" class="sidebar-link">Enable database session store</a></li><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#enable-file-session-store" class="sidebar-link">Enable file session store</a></li><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#using-the-session-store" class="sidebar-link">Using the session store</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#using-multiple-security-providers" class="sidebar-link">Using multiple security providers</a></li><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#expire-sessions" class="sidebar-link">Expire sessions</a></li><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#auto-responses" class="sidebar-link">Auto responses</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#auto-redirect-responses" class="sidebar-link">Auto redirect responses</a></li><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#auto-json-responses" class="sidebar-link">Auto JSON responses</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#configure-session-tokens" class="sidebar-link">Configure session tokens</a></li><li class="sidebar-sub-header"><a href="/guide/advancedguides/user_management.html#next-steps" class="sidebar-link">Next steps</a></li></ul></li><li><a href="/guide/advancedguides/templates.html" class="sidebar-link">Views &amp; Templates</a></li><li><a href="/guide/advancedguides/static_files.html" class="sidebar-link">Static files</a></li><li><a href="/guide/advancedguides/services.html" class="sidebar-link">Services</a></li><li><a href="/guide/advancedguides/dependency_injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/guide/advancedguides/emails.html" class="sidebar-link">Sending emails</a></li></ul></section></li><li><a href="/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/cli.html" class="sidebar-link">Command-line interface (CLI)</a></li><li><a href="/roadmap.html" class="sidebar-link">Roadmap</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="frontmatter-title"><a href="#frontmatter-title" class="header-anchor">#</a> User and Session Management</h1> <div data-v-3d11b470><div class="reading-time" data-v-3d11b470>
    18 min read (3487 words)
  </div> <div class="illustration-container" data-v-3d11b470><img src="/guide/user_management.svg" class="illustration-image" data-v-3d11b470></div> <h2 data-v-3d11b470><a href="#" class="header-anchor" data-v-3d11b470>#</a> Table of contents</h2> <div data-v-3d11b470><p data-v-3d11b470></p><div class="table-of-contents" data-v-3d11b470><ul data-v-3d11b470><li data-v-3d11b470><a href="#introduction" data-v-3d11b470>Introduction</a></li><li data-v-3d11b470><a href="#a-basic-example" data-v-3d11b470>A basic example</a></li><li data-v-3d11b470><a href="#choosing-the-right-auth-strategy" data-v-3d11b470>Choosing the right auth strategy</a></li><li data-v-3d11b470><a href="#accessing-a-user-session" data-v-3d11b470>Accessing a user session</a></li><li data-v-3d11b470><a href="#managing-session-related-data" data-v-3d11b470>Managing session related data</a><ul data-v-3d11b470><li data-v-3d11b470><a href="#enable-redis-session-store" data-v-3d11b470>Enable redis session store</a></li><li data-v-3d11b470><a href="#enable-database-session-store" data-v-3d11b470>Enable database session store</a></li><li data-v-3d11b470><a href="#enable-file-session-store" data-v-3d11b470>Enable file session store</a></li><li data-v-3d11b470><a href="#using-the-session-store" data-v-3d11b470>Using the session store</a></li></ul></li><li data-v-3d11b470><a href="#using-multiple-security-providers" data-v-3d11b470>Using multiple security providers</a></li><li data-v-3d11b470><a href="#expire-sessions" data-v-3d11b470>Expire sessions</a></li><li data-v-3d11b470><a href="#auto-responses" data-v-3d11b470>Auto responses</a><ul data-v-3d11b470><li data-v-3d11b470><a href="#auto-redirect-responses" data-v-3d11b470>Auto redirect responses</a></li><li data-v-3d11b470><a href="#auto-json-responses" data-v-3d11b470>Auto JSON responses</a><ul data-v-3d11b470><li data-v-3d11b470><a href="#login" data-v-3d11b470>Login</a></li><li data-v-3d11b470><a href="#logout" data-v-3d11b470>Logout</a></li><li data-v-3d11b470><a href="#failed" data-v-3d11b470>Failed</a></li><li data-v-3d11b470><a href="#forbidden" data-v-3d11b470>Forbidden</a></li></ul></li></ul></li><li data-v-3d11b470><a href="#configure-session-tokens" data-v-3d11b470>Configure session tokens</a></li><li data-v-3d11b470><a href="#next-steps" data-v-3d11b470>Next steps</a></li></ul></div></div></div><p></p> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>A modern web application need a way to identify users across multiple requests and ZenTS provides you with all the tools you need to do so. In this guide, you'll learn how to use cookies, sessions and so-called security providers to handle URL resources, which are only accessible for specific users. Since ZenTSs user management system makes (optional) use of redis or other databases, you should read the <a href="/guide/advancedguides/redis.html">redis guide</a> and the <a href="/guide/advancedguides/database.html">database guide</a> before continuing.</p> <p>The user management is highly configurable to tailer it to your needs. The key features are:</p> <ul><li>Multiple security providers, which allows different user (roles) to access locked resources (e.g. a &quot;Admin&quot; security provider and a &quot;User&quot; security provider).</li> <li>Multiple store adapters to save session related data either in redis, RDBMS or on the file system (for development/testing purpose).</li> <li>Strong password generators to store your users password securely using <em>bcrypt</em> or <em>argon2id</em> algorithm.</li> <li>Using <a href="https://jwt.io/" target="_blank" rel="noopener noreferrer">JSON Web Token<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which are developed against <a href="https://tools.ietf.org/html/draft-ietf-oauth-json-web-token-08" target="_blank" rel="noopener noreferrer">draft-ietf-oauth-json-web-token-08<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to save user related information on the client side.</li></ul> <h2 id="a-basic-example"><a href="#a-basic-example" class="header-anchor">#</a> A basic example</h2> <p>Before we start with a basic example, please make sure that you've enabled and configured <a href="/guide/advancedguides/redis.html">redis</a>. In addition, you need to setup a <a href="/guide/advancedguides/database.html">database</a> where your users are saved. In our example, we will force the user to send cookie to access a page behind a &quot;firewall&quot;. First we need to make sure that we configure everything correctly. This is done by setting the <code>config.security</code> configuration properties.</p> <p>Open your configuration file and add the following:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;enable&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;secretKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DONTUSEME&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;providers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;entity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;store&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;redis&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;redis&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;enable&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>The above config is the basic config for the security system, since <a href="/configuration.html">most configuration properties</a> have default values.</p> <ul><li><em>line 3</em>: Enable the security system.</li> <li><em>line 4</em>: The security system needs a strong secret key, which is used to encrypt the JSON Web Token. <strong>This key should never been exposed to the public</strong>. You can use <a href="/cli.html">ZenTS-CLI</a> to generate a secret key by calling <code>zen security:secret-key</code> in a terminal.</li> <li><em>line 5</em>: Here we define our so-called security provider(s). A provider needs at least a entity, which is connected to a corresponding table containing user data. ZenTS supports multiple security providers. When using multiple security providers, you've to specify a <code>name</code> property for every provider.</li> <li><em>line 6</em>: We enable a store (redis in that case) for our security provider. Session related data will be saved in that store (a store is always mandatory). ZenTS supports other store types (discussed later in this guide) then redis, but given its nature as key-value store, redis is generally considered the best choice to save sessions.</li></ul> <p>Before we can using our security provider, we need to create the <code>User</code> entity:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// src/entity/User.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Column<span class="token punctuation">,</span> Entity<span class="token punctuation">,</span> PrimaryGeneratedColumn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  @<span class="token function">PrimaryGeneratedColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>

  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  username<span class="token operator">:</span> <span class="token builtin">string</span>

  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  password<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>This is a basic user class, with just an <code>id</code>, <code>username</code> and <code>password</code> column. The <code>username</code> and <code>password</code> fields are required in order for the provider to localize the correct user record. You can overwrite the column names with the <code>table.identifierColumn</code> (default: <code>username</code>) and <code>table.passwordColumn</code> (default: <code>password</code>) config properties.</p> <p>When creating a new user account, make sure to save the password with the right encryption, which is either <code>argon2id</code> or <code>bcrypt</code> (can be configured by setting the <code>algorithm</code> property). The default encryption is <code>argon2id</code>. To illustrate this process, we create a new controller action which will create a new user account for us:</p> <div class="language-typescript line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><br></div><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> EntityManager <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> body<span class="token punctuation">,</span> Controller<span class="token punctuation">,</span> put<span class="token punctuation">,</span> securityProvider<span class="token punctuation">,</span> SecurityProvider<span class="token punctuation">,</span> entityManager <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'zents'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../entity/User'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token keyword">extends</span></span> Controller <span class="token punctuation">{</span>
  @entityManager
  <span class="token keyword">private</span> em<span class="token operator">:</span> EntityManager

  @<span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">createUser</span><span class="token punctuation">(</span>
    @body
    body<span class="token operator">:</span> <span class="token punctuation">{</span>
      username<span class="token operator">:</span> <span class="token builtin">string</span>
      password<span class="token operator">:</span> <span class="token builtin">string</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    @<span class="token function">securityProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    security<span class="token operator">:</span> SecurityProvider<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    user<span class="token punctuation">.</span>username <span class="token operator">=</span> body<span class="token punctuation">.</span>username
    user<span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token keyword">await</span> security<span class="token punctuation">.</span><span class="token function">generatePasswordHash</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span>password<span class="token punctuation">)</span>

    user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>If you followed this guide closely, you already understand most of the above code. The important magic here comes from the <code>@securityProvider()</code> decorator, which exposes a <code>generatePasswordHash(plainText: string)</code> method, that we can use to generate a hashed password with the correct algorithm. In our example, the user input is transmitted via a <a href="/guide/advancedguides/request.html#request-body">request body</a>, but it's actually up to your implementation how you create a user. Just make sure that you create the password hash via the security provider <code>generatePasswordHash()</code> method (or implement your own solution which generates compatible <code>argon2id</code> or <code>bcrypt</code> hashes).</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Both algorithm, <code>argon2id</code> and <code>bcrypt</code>, have some optional configuration properties. They are described in the <a href="/configuration.html">configuration guide</a>.</p></div> <p>After you've created a user, it's time to login. First we need to create a simple HTML login form.</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/login<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Username: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Password: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Login<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This simple form sends the <code>username</code> and <code>password</code> to a <code>/login</code> page. If you submit this form (with valid credentials), a cookie will be send to the user, which is used for further requests to secured routes.</p> <p>The login URL can be configured for each provider, in fact, when your application has more then one provider, it's mandatory to set URLs for each provider. If the application has only one provider, and a custom URL isn't provided, the <code>/login</code> URL will be created automatically. To set a custom URL, us the <code>url</code> property. Furthermore, if you want different form-field names then <code>username</code> and/or <code>password</code>, you have to configure them in the <code>fields</code> property.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;providers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;login&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/custom-login&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;logout&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/custom-logout&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pin&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>The last step of our example is to create a route that is actually locked behind a firewall, so that only user with a valid cookie can access it. In order to do so, we use the <code>@auth()</code> decorator provided by the ZenTS framework:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code>@<span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
@<span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/super-secret'</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">secretArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token operator">:</span> <span class="token string">'secret'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The <code>/super-secret</code> URL is now secured and can only be viewed with a valid cookie.</p> <h2 id="choosing-the-right-auth-strategy"><a href="#choosing-the-right-auth-strategy" class="header-anchor">#</a> Choosing the right auth strategy</h2> <p>When a request is made to <code>@auth()</code> secured controller actions, ZenTS will take care that the user has access to the resource. The framework will look at two locations for a session token:</p> <ul><li><em>Header</em>: The token has to be send in a HTTP <code>Authorization</code> header token (<code>Authorization: Bearer TOKEN</code>).</li> <li><em>Cookie</em>: The token has to be send in a cookie.</li> <li><em>Hybrid</em>: The token has to be send either in a HTTP header or cookie.</li></ul> <p>The <em>header</em> strategy is usually preferred when you want to write an API. Clients consuming the API have to send the authorization header for every request they make. If you're writing a more traditional web application, that has direct user interaction, you better choose the <em>cookie</em> strategy. Requesting the login route will automatically create a cookie when a user is successfully authorized. The key of the cookie can be set using the (optional) <code>security.cookieKey</code> <a href="/configuration.html">configuration</a> property. The hybrid strategy can be used if you wish to support both, http authorization header and cookies.</p> <p>Example using cookie strategy <a href="/configuration.html">configuration</a>:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;strategy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cookie&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;cookieKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;app_&quot;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>cookieKey</code> is optional and defaults to <code>zenapp_jwt</code></p> <p>Example using header strategy <a href="/configuration.html">configuration</a>:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;strategy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;header&quot;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Don't use the &quot;header&quot; strategy if you intend to use auto redirect response, please use the auto json response type. Take a look at &quot;<a href="#auto-redirect-responses">Auto redirect responses</a>&quot; section for more details.</p></div> <h2 id="accessing-a-user-session"><a href="#accessing-a-user-session" class="header-anchor">#</a> Accessing a user session</h2> <p>A user can be injected into a controller action using the <code>@session()</code> decorator:</p> <div class="language-typescript line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> EntityManager <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Session <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'zents'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> auth<span class="token punctuation">,</span> Controller<span class="token punctuation">,</span> <span class="token keyword">get</span><span class="token punctuation">,</span> session<span class="token punctuation">,</span> log <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'zents'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../entity/User'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token keyword">extends</span></span> Controller <span class="token punctuation">{</span>
  @<span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/example'</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">example</span><span class="token punctuation">(</span>@<span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span> session<span class="token operator">:</span> Session<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>session<span class="token punctuation">.</span><span class="token function">isAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
      log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  @<span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  @<span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/member-area'</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">memberArea</span><span class="token punctuation">(</span>@<span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span> session<span class="token operator">:</span> Session<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>Lets take a look at this example step-by-step:</p> <ul><li>The <code>@session()</code> decorator injects a session into the controller action, which is bound to the <code>session</code> variable.</li> <li>The <code>Session</code> TypeScript interface has one generic type argument, which is set to our <code>User</code> entity. This allows TypeScript to resolve the <code>user</code> property type correctly and will show corresponding autocomplete results in your IDE.</li> <li>Since the <code>/example</code> route isn't behind a firewall (because we didn't use the <code>@auth()</code> decorator) every user can make a request to this URL. We use <code>session.isAuth()</code> here to make sure the user is authorized.</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When the URL is behind a firewall (<code>@auth()</code>), you can skip the call to <code>session.isAuth()</code>. ZenTS will make sure that only authorized users can access the resource.</p></div> <p>When your application has multiple security providers, you've to specify the name of the provider in the <code>@session()</code> and <code>@auth()</code> decorators:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> EntityManager <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Session <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'zents'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> auth<span class="token punctuation">,</span> Controller<span class="token punctuation">,</span> <span class="token keyword">get</span><span class="token punctuation">,</span> session <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'zents'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Admin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../entity/Admin'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../entity/User'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token keyword">extends</span></span> Controller <span class="token punctuation">{</span>
  @<span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/example'</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">example</span><span class="token punctuation">(</span>
    @<span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span> adminSession<span class="token operator">:</span> Session<span class="token operator">&lt;</span>Admin<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    @<span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span> userSession<span class="token operator">:</span> Session<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userSession<span class="token punctuation">.</span><span class="token function">isAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>userSession<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
      log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>userSession<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  @<span class="token function">auth</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span>
  @<span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">example</span><span class="token punctuation">(</span>@<span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span> adminSession<span class="token operator">:</span> Session<span class="token operator">&lt;</span>Admin<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>adminSession<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="managing-session-related-data"><a href="#managing-session-related-data" class="header-anchor">#</a> Managing session related data</h2> <p>Usually a web application needs to save some additional user related data inside a session. For example, a e-commerce shop needs to remember which basket belongs to which customer. Of course, the application could just store this information inside the related database record, but this becomes fast unmaintainable and bloated. ZenTS has a concept of so-called <strong>session stores</strong>, which allows you to save extra data for every security provider. It's <strong>mandatory</strong> to configure a store for every security provider.</p> <p>The builtin session stores are:</p> <ul><li><strong><em>redis</em></strong> (recommend): Stores session data in a <a href="/guide/advancedguides/redis.html">redis</a> key-value database. This is the preferred session store, because redis architecture scales very well under heavy load and is easy extendible.</li> <li><strong><em>database</em></strong>: Stores session data in a database table using the <a href="/guide/advancedguides/database.html">ORM</a>.</li> <li><strong><em>file</em></strong>: Saves session data in multiple JSON files. The file session store should <strong>only be used for development or testing purpose</strong>, because it isn't build with performance in mind and doesn't scale well in applications under heavy load.</li></ul> <h3 id="enable-redis-session-store"><a href="#enable-redis-session-store" class="header-anchor">#</a> Enable redis session store</h3> <p>To enable the redis session store, set <code>store.type</code> to <code>redis</code>:</p> <div class="language-json line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;providers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;entity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;store&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;redis&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;prefix&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sessions_&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;keepTTL&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li><em>line 7</em>: Set the store to <code>redis</code>.</li> <li><em>line 8</em>: The prefix used when generating the key (optional, default: <code>zen_</code>).</li> <li><em>line 9</em>: Set <code>keepTTL</code> to true, to retain the time to live for this session (optional, default: <code>false</code>).</li></ul> <p>Make sure to <a href="/configuration.html">configure</a> <a href="/guide/advancedguides/redis.html">redis</a> correctly before enabling the redis session store.</p> <h3 id="enable-database-session-store"><a href="#enable-database-session-store" class="header-anchor">#</a> Enable database session store</h3> <p>To enable the database session store, set <code>store.type</code> to <code>database</code>:</p> <div class="language-json line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;providers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;entity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;store&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;database&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;entity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Session&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>The <code>entity</code> property is required and should point to an valid <a href="/guide/advancedguides/database.html">entity</a>, that has at least the following implementation:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// src/entity/Session.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Column<span class="token punctuation">,</span> Entity<span class="token punctuation">,</span> PrimaryColumn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Session</span> <span class="token punctuation">{</span>
  @<span class="token function">PrimaryColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span>

  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  data<span class="token operator">:</span> <span class="token builtin">string</span>

  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  created_at<span class="token operator">:</span> Date

  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  expired_at<span class="token operator">:</span> Date
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="enable-file-session-store"><a href="#enable-file-session-store" class="header-anchor">#</a> Enable file session store</h3> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>The file session store should only be used for development or testing purpose. You can configure your session stores differently for every environment. Please take a look at the <a href="/configuration.html">configuration guide</a> for more information.</p></div> <p>To enable the file session store, set <code>store.type</code> to <code>file</code>:</p> <div class="language-json line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;providers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;entity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;store&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;folder&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/absolute/path/to/folder&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;prefix&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sessions_&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>The folder, where session files are stored, must be an absolute path pointing to an exiting directory on the host. Optionally you can define a filename prefix, which defaults to <code>zen_</code>. Session files are stored as JSON files inside the given directory.</p> <h3 id="using-the-session-store"><a href="#using-the-session-store" class="header-anchor">#</a> Using the session store</h3> <p>After you've configured a session store, you can begin to work with it in a <a href="/guide/advancedguides/controllers.html">controller action</a>:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code>@<span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/example'</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">example</span><span class="token punctuation">(</span>@<span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span> session<span class="token operator">:</span> Session<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  session<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span> <span class="token comment">// set a new key-value property</span>
  session<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token comment">// get a value by key, with optional type casting</span>
  session<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token comment">// remove a value by key</span>

  session<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'basket'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
    items<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// set, get and remove methods can lookup properties &quot;paths&quot;, separated with a dot</span>
  session<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'basket.id'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">'basket.id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// logs 1</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>The above example is pretty straightforward. The session store can accept any JSON serialize-able value, like objects, arrays or strings. The session store will automatically be updated at the end of the request lifecycle, but you can save it manually by calling <code>await session.data.save()</code>.</p> <h2 id="using-multiple-security-providers"><a href="#using-multiple-security-providers" class="header-anchor">#</a> Using multiple security providers</h2> <p>ZenTS supports multiple security providers, for example a web application might have &quot;normal&quot; users and administrators, which have different access rights to specific resources.</p> <div class="language-json line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;providers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;entity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;store&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;redis&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;login&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;logout&quot;</span><span class="token operator">:</span> /user/logout&quot;
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;entity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Admin&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;store&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;redis&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;login&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/admin/login&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;logout&quot;</span><span class="token operator">:</span> /admin/logout&quot;
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>When using multiple providers, it's required to set a <code>name</code> for every provider, otherwise you can't reference the right session in your controller action. Furthermore you've to setup a <code>login</code> and <code>logout</code> URL for every security provider. These URLs are then used to login/logout, e.g. via a HTML form or REST client. Normally ZenTS provides default values for the <code>name</code> (default: <code>default</code>), <code>login</code> (default: <code>/login</code>) and <code>logout</code> (default: <code>/logout</code>), but they can't be used when configuring multiple providers, because user need to identify them self with a unique resources.</p> <p>Furthermore a user can authenticate them self with multiple providers, e.g. an admin that is also logged in with his own customer account. ZenTS will store session information on the client side only in one token, no matter how many logins the client has been authenticated to. When using the cookie strategy, a new cookie is issued and the old one is destroyed, but when you've chosen the header strategy, clients have to supply the newly issued token and drop the old one by them self.</p> <p>After you've enabled multiple session providers, you've to specify the <code>name</code> of a provider as an argument to <code>@session(name: string)</code> when injecting the session into a controller action:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">example</span><span class="token punctuation">(</span>
  @<span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span> session<span class="token operator">:</span> Session<span class="token operator">&lt;</span>Admin<span class="token operator">&gt;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Thanks to dependency injection, you can of course inject all providers you need into a action, just make sure to provide the correct <code>name</code> and <code>Session&lt;ENTITY&gt;</code> for each session.</p> <p>The same thing counts also for the <code>@auth()</code> annotation, which accepts the <code>name</code> as the first argument:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code>@<span class="token function">auth</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">secretArea</span><span class="token punctuation">(</span>
  @<span class="token function">session</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span> session<span class="token operator">:</span> Session<span class="token operator">&lt;</span>Admin<span class="token operator">&gt;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If you just use one provider you can omit the <code>name</code> argument (in config, <code>@auth()</code>, <code>@session()</code>), but it's recommend to always specify a name for a provider, because that makes life easier when adding more providers later.</p></div> <h2 id="expire-sessions"><a href="#expire-sessions" class="header-anchor">#</a> Expire sessions</h2> <p>Without configuration a session will expire after 7 days. You can change the expire time for every security provider with the <code>expire</code> property:</p> <div class="language-json line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;providers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token property">&quot;expire&quot;</span><span class="token operator">:</span> <span class="token string">&quot;30 days&quot;</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>The above example will set the expire time for session to 30 days. The <code>expire</code> property will except time strings or a number in milliseconds. Please take a look at the <a href="/configuration.html">configuration guide</a> for more details about time strings.</p> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>Sessions are automatically deleted from the redis store when they expire. That is done by setting the TTL for each key in the redis store. That isn't possible for the database and file stores. ZenTS will only make sure that the session hasn't been expired yet, when a request has been made, but it won't delete old sessions from the database (or filesystem). Currently you've to do this by hand, but sooner or later ZenTS will provide a CLI command to automatically clean expired sessions. The only exception from this behavior is, when the user calls <code>/logout</code>. The store data will then be deleted no matter which store the application is using.</p></div> <p>## Manually destroy a session</p> <p>A session can be manually destroyed before it expires by calling the <code>destroy()</code> method:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code>@<span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">deleteMySelf</span><span class="token punctuation">(</span>
  @<span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span> session<span class="token operator">:</span> Session<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> session<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>This will destroy the session immediately and all members of the session variable will become <code>null</code> (e.g. <code>session.user</code> becomes <code>null</code>).</p> <h2 id="auto-responses"><a href="#auto-responses" class="header-anchor">#</a> Auto responses</h2> <p>ZenTS will send auto responses when specific actions happen, e.g. when a user calls <code>/login</code> with wrong credentials. These responses can be configured for every security provider, allowing you to fine tune the behavior of each action.</p> <p>There are two auto response types available:</p> <ul><li><em>Redirect response</em>: Redirect the action to a different URL without returning a response body. This is usually sufficient when you're creating a simple web application without fancy frontend frameworks.</li> <li><em>JSON response</em>: Will automatically send a JSON response body with data for each auto response action. If your application has some heavy JavaScript frontend code you probably want to choose this options, because it will give you more freedom on how you handle tokens and forbidden requests in the UI.</li></ul> <p>Both auto response types are discussed detailed in the following chapters.</p> <h3 id="auto-redirect-responses"><a href="#auto-redirect-responses" class="header-anchor">#</a> Auto redirect responses</h3> <p>To use auto redirect responses, set the <code>provider.responseType</code> config property to <code>redirect</code> (this is also the default when <code>responseType</code> isn't set).</p> <div class="language-json line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;providers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token property">&quot;responseType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;redirect&quot;</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Now you can configure the URLs for the 4 redirect action types:</p> <div class="language-json line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;providers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token property">&quot;responseType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;redirect&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;redirect&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;login&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/member-area&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;logout&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/goodbye&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;failed&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/login-form&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;forbidden&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/forbidden&quot;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li><em>login</em>: The redirect URL after successfully logged in.</li> <li><em>logout</em>: The redirect URL after successfully logged out.</li> <li><em>failed</em>: The redirect URL after failed to login or logout.</li> <li><em>forbidden</em>: The redirect URL after try to access a secured route.</li></ul> <p>All of these URLs have a default value (<code>/</code>), it's recommend to set a value for every URL and create a corresponding controller action for each URL.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The auto redirect responses doesn't play nicely together with the <code>header</code> authorization strategy, because the client will never receive the token when getting redirected after a login happens. You should use the <code>json</code> response type in that case.</p></div> <h3 id="auto-json-responses"><a href="#auto-json-responses" class="header-anchor">#</a> Auto JSON responses</h3> <p>To enable auto JSON responses, set the <code>provider.responseType</code> config property to <code>json</code>. There aren't any more configuration parameters for the response type, it just works™ and will work with all three authorization strategies (<code>cookie</code>, <code>header</code> or <code>hybrid</code>).</p> <p>These responses will be returned:</p> <h4 id="login"><a href="#login" class="header-anchor">#</a> Login</h4> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;TOKEN&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Will also return a cookie, when strategy is set to <code>cookie</code> or <code>hybrid</code>. Save the response token on the client somewhere when you're using the <code>header</code> strategy.</p> <h4 id="logout"><a href="#logout" class="header-anchor">#</a> Logout</h4> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;logout&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="failed"><a href="#failed" class="header-anchor">#</a> Failed</h4> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;statusCode&quot;</span><span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
  <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Bad Request&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Authorization missing&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="forbidden"><a href="#forbidden" class="header-anchor">#</a> Forbidden</h4> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;statusCode&quot;</span><span class="token operator">:</span> <span class="token number">403</span><span class="token punctuation">,</span>
  <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Forbidden&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Forbidden&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="configure-session-tokens"><a href="#configure-session-tokens" class="header-anchor">#</a> Configure session tokens</h2> <p>ZenTS security system uses encrypted <a href="https://jwt.io/" target="_blank" rel="noopener noreferrer">JSON Web Token<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> which is either stored in a cookie or transmitted via HTTP header (depending on the chosen strategy). No matter how many security providers the application has, the framework will only issue one session token for a client and handle multiple logins to different providers internally.</p> <p>The JSON Web Token can be configured with the <code>security.token</code> configuration property (all properties have a default value):</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;token&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;algorithm&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HS512&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;audience&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo:bar&quot;</span><span class="token punctuation">,</span> <span class="token comment">// or [&quot;foo:bar&quot;, &quot;baz:boz&quot;]</span>
      <span class="token property">&quot;issuer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;company&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;subject&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;jwtid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1234-5678&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;keyid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1234-5678&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Currently ZenTS supports <code>HS256</code>, <code>HS384</code>, <code>HS512</code> as token encryption algorithm (others like <code>RS256</code> or <code>PS512</code> are currently unsupported, but will be added in a later release). The rest are standard JSON Web Token properties, please refer to the <a href="https://jwt.io/" target="_blank" rel="noopener noreferrer">official documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for a detailed explanation.</p> <h2 id="next-steps"><a href="#next-steps" class="header-anchor">#</a> Next steps</h2> <p>Congratulation 🎉 Now you should be familiar with the user and session management system ZenTS provides. It's fully flexible and can be used to secure controller actions from unwanted visitors. The next guide will cover <a href="/guide/advancedguides/templates.html">views and templates</a> and teaches you, how to use the builtin template engine efficiently.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/sahachide/ZenTS/edit/master/docs/guide/advancedguides/user_management.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/11/2021, 1:20:36 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/advancedguides/redis.html" class="prev">
        Redis
      </a></span> <span class="next"><a href="/guide/advancedguides/templates.html">
        Views &amp; Templates
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.ff0d6eb6.js" defer></script><script src="/assets/js/2.1831a849.js" defer></script><script src="/assets/js/26.dcb85366.js" defer></script><script src="/assets/js/4.be0fa7c4.js" defer></script>
  </body>
</html>
